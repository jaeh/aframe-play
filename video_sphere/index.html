<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>sphere 01</title>
    <meta name="description" content="Hello, WebVR! â€¢ A-Frame">
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.min.js"></script>

    <script src="https://unpkg.com/aframe-render-order-component@1.1.0/dist/aframe-render-order-component.min.js"></script>
    <style>
      .play-overlay {
        z-index: 99999;
        position: fixed;
        bottom: 60px;
        right: 20px;
        box-sizing: border-box;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        padding: 12px 24px;
        padding-bottom: 0px;
        background: rgba(0, 0, 0, 0.5) url(./assets/white-play-256.png) center no-repeat;
        background-size: 40px 40px;
      }
      .play-overlay:hover {
        background: rgba(0, 0, 0, 0.2) url(./assets/white-play-256.png) center no-repeat;
        background-size: 40px 40px;
      }

    </style>

  </head>
  <body>

    <a id="playButton" onclick="play('video_1')"><div class="btn btn-primary play-overlay menu-overlay"></div></a>

    <a-scene background="color: #212122" renderer="sortObjects: true;" shadow="autoUpdate: true">

      <a-assets>
        <video id="video_1" src="assets/aframe_video.webm"
        crossOrigin="anonymous"
        autoplay="false"
        loop="true"
        duration="16000"
        opacity="0.8"
        ></video>
        
        </a-assets>

        <!-- Red directional light shining from the top left. -->
        <a-entity light="type:directional; castShadow:true;" position="1 1 1"></a-entity>

        <a-entity light="type: spot; angle: 45"></a-entity>

        <a-entity light="type: point; intensity: 0.55; distance: 10; decay: 9"position="0 2.25 -5"></a-entity>
      
        <a-sphere
        id="L1"
        material="src: #video_1; side: double; transparent: true; alphaTest: 0.53; opacity: 0.8;"
        segments-height="128"
        segments-width="128"
        position="0 2.25 -5" 
        radius="0.55" 
        displacement-map="#video_1"
        displacement-bias="0"
        animation__1op="property: opacity; dur: 8000; easing: linear; easing: easeInOutElastic; from:1; to: 0; dir: alternate; loop: true;"
        animation__1rot="property: rotation; dur: 8000; easing: linear; dir: normal; from:0 0 0; to: 0 -360 0; loop: true;"
        animation__1sc="property: scale; easing: easeInOutElastic; from: 2 2 2; to: 3 3 3; dir: alternate; loop: true;"
        animation__1dis="property: material.displacementScale; dir: alternate; from: 0.2; to: -0.1; dur: 3000; loop: true;"
        animatedPng
        ></a-sphere>
        
          

      <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#2c2c2c" shadow></a-plane>
    </a-scene>

    <script> 

    videoTexture.format = THREE.RGBAFormat
    // wait until the material is ready
    this.el.addEventListener('materialtextureloaded', e => {
       // grab the material
       let material = this.el.getObject3D("mesh").material;
       // swap the format
       material.map.format = THREE.RGBAFormat;
       material.map.needsUpdate = true;
    })
    //Playbutton for video
      function play(id){
        var aVideoAsset = document.querySelector('#' + id);
        aVideoAsset.play().catch(function (error) {
          aVideoAsset.pause();
          hideOrShow("playButton");

        });
        aVideoAsset.setAttribute('loop', 'false');
        hideOrShow('playButton');
      }
      function hideOrShow(id) {
        var x = document.getElementById(id);
        if (x.style.display === "none") {
          x.style.display = "block";
        } else {
          x.style.display = "none";
        }
      }


    // corona statistic
      const confirmed_t1 = 660706;
      const confirmed_t0 = 593291;
      const confirmed = (confirmed_t1 - confirmed_t0)/confirmed_t0;

      const deaths_t1 = 30652;
      const deaths_t0 = 27198;
      const deaths = (deaths_t1 - deaths_t0)/deaths_t0;

      const recovered_t1 = 139415;
      const recovered_t0 = 130915;
      const recovered = (recovered_t1 - recovered_t0)/recovered_t0;

      console.log("C " + confirmed,"D " + deaths, "R " +recovered);

      //Animations on load
      const scene = document.querySelector('a-scene');
      
      const run = () => {

      //L1 
        const sphere = document.querySelector("#L1");
        const mat_1 = sphere.getAttribute("material");

        const anim_1op = sphere.getAttribute("animation__1op");
        const anim_1sc = sphere.getAttribute("animation__1sc");
        const anim_1dis = sphere.getAttribute("animation__1dis");
        const anim_1rot = sphere.getAttribute("animation__1rot");
      
/*      //L2
        const sphere = document.querySelector("#L2");
        const anim_1op = sphere.getAttribute("animation__2op");
        const anim_1sc = sphere.getAttribute("animation__2sc");
        const anim_1dis = sphere.getAttribute("animation__2dis");
        const anim_1rot = sphere.getAttribute("animation__2rot");

        //L3
        const sphere = document.querySelector("#L3");
        const anim_1op = sphere.getAttribute("animation__3op");
        const anim_1sc = sphere.getAttribute("animation__3sc");
        const anim_1dis = sphere.getAttribute("animation__3dis");
        const anim_1rot = sphere.getAttribute("animation__3rot");*/

      // Test

        if (confirmed > 0.1 && confirmed < 0.3){
          //L1
          anim_1sc.from = "3 3 3";
          anim_1sc.dur = 6000; 
          anim_1op.dur = 6000;
          anim_1op.from = 1;
          anim_1op.to = 1;
          anim_1dis.to = 1;
        } 

        sphere.setAttribute("animation__1op", anim_1op);
        sphere.setAttribute("animation__1sc", anim_1sc);
        sphere.setAttribute("animation__1dis", anim_1dis);
        sphere.setAttribute("animation__1rot", anim_1rot);
        
        console.log("hello", confirmed);
      }

      if (scene.hasLoaded) {
        run()
      } else {
        scene.addEventListener('loaded', run)
      }

    </script>

  </body>
</html>